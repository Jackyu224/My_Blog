---
layout: post
title: "MySQL 子查询"
date: 2025-02-11
categories: mysql
thumbnail: /style/image/wzy.jpg
icon: note
---

* content
{:toc}
### 子查询

**子查询**（Subquery）是嵌套在其他 SQL 查询中的查询

子查询可以嵌套在 `SELECT`、`INSERT`、`UPDATE` 或 `DELETE` 语句中。它的结果通常是一个 **值**、**一列** 或 **一张表**，这个结果会在外部查询中使用。

子查询通常用于：

- 筛选条件：在 `WHERE` 子句中使用，作为查询条件。
- 聚合计算：在 `SELECT` 子句中计算某些值。
- 排序：在 `ORDER BY` 子句中作为排序依据。

#### **子查询的类型**

1. **标量子查询**：返回单个值。
2. **列子查询**：返回一列。
3. **表子查询**：返回多行多列。
4. **相关子查询**：外部查询和内部查询通过引用外部查询的列来进行关联

```sql
SELECT columns
FROM table
WHERE column operator (
    SELECT column
    FROM table
    WHERE condition
);

```

### 相关子查询

依赖外层查询的子查询

子查询中的 `WHERE cid = sc.cid` 引用了外层查询的 `sc.cid`。

**SQL 会为外层查询的每一行执行一次子查询**，传入对应的 `sc.cid`。

```sql
SELECT * FROM t1
  WHERE column1 = ANY (SELECT column1 FROM t2
                       WHERE t2.column2 = t1.column2);
```

子查询包含对列的引用 `t1`，即使子查询的 `FROM`子句未提及表 `t1`。因此，MySQL 在子查询之外查找，并`t1`在外部查询中查找。

| 🚀 开发阶段 | ✅ 建议 |
| ---------- | ------ |
|            |        |

| **调试阶段 (Test)** | ✅ 相关子查询简单且直观，易于验证逻辑 |
| ------------------- | ------------------------------------ |
|                     |                                      |

| **数据分析 (BI)** | ✅ 可用相关子查询处理小数据，灵活度高 |
| ----------------- | ------------------------------------ |
|                   |                                      |

| **生产环境 (Prod)** | ⚠️ 避免相关子查询，优先使用 `JOIN`、索引或临时表 |
| ------------------- | ----------------------------------------------- |
|                     |                                                 |

| **性能优化 (Tune)** | ✅ 尝试 `JOIN` 或临时表，添加索引提高速度 |
| ------------------- | ---------------------------------------- |
|                     |                                          |
