---
layout: post
title: "MySQL 查询数据"
date: 2025-02-11
categories: MySQL
thumbnail: /style/image/qoy.png
icon: note
---

* content
{:toc}
## 查询数据

WHERE 用于指定过滤条件，只返回符合的行。

ORDER BY …  ASC 或 DESC  用于指定结果集的排序顺序，默认是升序（ASC）。

LIMIT ，用于限制返回的行数。 DISTINCT，去重



```sql
SELECT column1, column2, ...
FROM table_name
[WHERE condition]
[ORDER BY column_name [ASC | DESC]]
[LIMIT number];

```



### 聚合函数



#### `COUNT()`计算查询结果中的行数，计算非 `null`的数量

```sql
SELECT COUNT(*) FROM employees;
SELECT COUNT(salary) FROM employees;  -- 计算非 NULL 值的数量
```

#### `SUM()`计算总和，用于数值列

```sql
SELECT SUM(salary) FROM employees;
```

#### `AVG()`计算平均值，用于数值列

#### `MAX()`计算最大值，返回某个字段的最大值

#### `MIN()` 计算最小值，返回某个字段的最小值



### GROUP BY

通常与 `GROUP BY` 语句结合使用，以对数据进行分组和计算。

`GROUP BY` 的作用是**把相同值的行分组在一起**，然后对每个组进行聚合计算。

结合 `HAVING`，可以筛选出符合特定条件的分组

#### `GROUP BY itemId` 的作用

`GROUP BY` 语句用于将结果集按照指定列（这里是 `itemId`）分组，每个分组会包含相同 `itemId` 的所有记录。然后，你可以对每个分组进行 **聚合计算**，例如 `SUM()`、`AVG()`、`COUNT()` 等。

#### `GROUP BY itemId` 如何工作



假设 `orderitem` 表的数据如下：

| itemId | bookid | orderid | quantity |
| ------ | ------ | ------- | -------- |
| 1      | 101    | 1001    | 5        |
| 1      | 101    | 1002    | 6        |
| 2      | 102    | 1003    | 7        |
| 2      | 102    | 1004    | 8        |
| 3      | 103    | 1005    | 9        |
| 3      | 103    | 1006    | 10       |



```sql
SELECT itemId, AVG(quantity) AS avg_quantity
FROM orderitem
GROUP BY itemId;

```

查询会按照 `itemId` 进行分组，然后对每个 `itemId` 计算 `quantity` 的平均值，结果如下：

| itemId | avg_quantity   |
| ------ | -------------- |
| 1      | (5+6)/2 = 5.5  |
| 2      | (7+8)/2 = 7.5  |
| 3      | (9+10)/2 = 9.5 |

所以 `GROUP BY itemId` **的意思是按照 `itemId` 进行分组，并对每个分组进行聚合计算**。

#### `GROUP BY` 之后只能使用聚合列

在 `GROUP BY` 语句后，查询的 `SELECT` 语句中只能包含：

1. **分组列**（itemId）
2. **聚合函数**（如 AVG(quantity)）

```sql
SELECT itemId, AVG(quantity) from table_name
GROUP BY itemId
```

#### `HAVING` 结合 `GROUP BY` 进行过滤

`HAVING` 用于**过滤分组后的数据**，类似于 `WHERE`，但 `WHERE` 不能用于 `GROUP BY` 后的聚合计算。

```sql
SELECT itemId, AVG(quantity) AS avg_quantity
FROM orderitem
GROUP BY itemId
HAVING AVG(quantity) > 6;

```



## 总结

- `GROUP BY itemId` = **按 `itemId` 进行分组**
- 只能在 `SELECT` 里使用 `itemId` 或 **聚合函数**（如 `AVG(quantity)`）
- 如果要过滤聚合结果，用 `HAVING`，不能用 `WHERE`
